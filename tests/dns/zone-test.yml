- hosts: localhost
  connection: local
  gather_facts: false

  vars_files:
    - ./vars.yml

  tasks:

  - name: Create Zone
    dns_zone:
      name: "{{zone_name}}"
      description: "{{zone_description}}"
      enabled: "{{zone_enabled}}"
    register: zone_response

  # - name: List Zones
  #   zone_info:
  #   register: zones_response

  # - name: Show Zones
  #   debug:
  #     var: zones_response.result

  - name: Update Zone
    dns_zone:
      zone: "{{ zone_response.zone.properties.zone_name }}"
      description: "{{zone_description_updated}}"
      enabled: "{{zone_enabled_updated}}"
      allow_replace: False
      state: update
    register: updated_zone_response

  - name: Update Zone no change
    dns_zone:
      zone: "{{ zone_response.zone.properties.zone_name }}"
      description: "{{zone_description_updated}}"
      enabled: "{{zone_enabled_updated}}"
      allow_replace: False
      state: update
    register: updated_zone_response

  - name: Asserting that changed == false when no update is made
    assert:
      that:
        - updated_zone_response.changed == false
      msg: "Changed should be false"

  - name: Delete Zone
    dns_zone:
      zone: "{{ zone_response.zone.properties.zone_name }}"
      wait: true
      state: absent

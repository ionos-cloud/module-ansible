- hosts: localhost
  connection: local
  gather_facts: false

  vars_files:
    - ../vars.yml

  tasks:

  - name: Create Registry
    registry:
      name: "{{registry_name}}"
      location: es/vit
      maintenance_window:
        days: 
          - Tuesday
          - Sunday
        time: 01:23:00+00:00
      garbage_collection_schedule:
        days: 
          - Wednesday
        time: 04:17:00+00:00
    register: registry_response

  - name: Create Registry Token
    registry_token:
      registry_id: "{{ registry_response.registry.id }}"
      name: testRegistryToken
      scopes:
      - actions:
        - pull
        - push
        name: nume
        type: repo
      status: enabled
      expiry_date: "2022-06-24T17:04:10+03:00"
    register: registry_token_response

  - name: List Registry Tokens
    registry_token_info:
      registry_id: "{{ registry_response.registry.id }}"
    register: registry_tokens_response

  # - name: Show Registry Tokens
  #   debug:
  #     var: registry_tokens_response.result

  - name: Update Registry Token
    registry_token:
      registry_id: "{{ registry_response.registry.id }}"
      name: "{{ registry_token_response.registry_token.properties.name }}"
      scopes:
      - actions:
        - pull
        - push
        - delete
        name: nume
        type: repo1
      status: disabled
      expiry_date: "2022-07-24T17:04:10+03:00"
      state: update
    register: registry_token_response

  - name: Delete Registry Token
    registry_token:
      registry_id: "{{ registry_response.registry.id }}"
      name: "{{ registry_token_response.registry_token.properties.name }}"
      state: absent
    register: registry_token_response

  - name: Delete Registry
    registry:
      name: "{{ registry_response.registry.properties.name }}"
      wait: true
      state: absent
